<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ØªØ­Ø¯ÙŠ Ø³ÙŠÙ† Ø¬ÙŠÙ… AI - Ù†Ø³Ø®Ø© Hugging Face</title>
    <style>
        :root { --gold: #fcc201; --orange: #ff6600; --dark-orange: #4a1c00; --accent: #ff9933; }
        body { background: var(--dark-orange); color: white; font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; text-align: center; overflow: hidden; }
        .setup-container { padding: 20px; height: 100vh; overflow-y: auto; display: flex; flex-direction: column; align-items: center; }
        .cat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; width: 100%; max-width: 600px; }
        .cat-item { background: rgba(0,0,0,0.6); border: 2px solid var(--accent); padding: 12px; border-radius: 10px; cursor: pointer; transition: 0.3s; }
        .cat-item.active { background: var(--orange); border-color: white; transform: scale(1.05); }
        .btn-start { background: var(--orange); color: white; border: none; padding: 15px 40px; font-size: 1.3rem; border-radius: 50px; cursor: pointer; margin: 20px 0; font-weight: bold; }
        .game-header { background: #1a0a00; padding: 15px; border-bottom: 3px solid var(--orange); display: flex; justify-content: space-around; font-weight: bold; }
        .game-board { display: grid; grid-template-columns: 1fr; gap: 15px; padding: 15px; height: calc(100vh - 60px); overflow-y: auto; }
        .cat-section { background: rgba(255,255,255,0.07); border-radius: 15px; padding: 12px; border: 1px solid var(--accent); }
        .vals-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .val-cell { background: var(--orange); height: 65px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold; border-radius: 8px; cursor: pointer; }
        .val-cell.used { opacity: 0.15; pointer-events: none; }
        .modal { position: fixed; inset: 0; background: var(--dark-orange); display: none; flex-direction: column; align-items: center; justify-content: center; padding: 25px; z-index: 1000; }
        #loadingOverlay { position: fixed; inset:0; background: rgba(0,0,0,0.95); display:none; flex-direction:column; justify-content:center; align-items:center; z-index:2000; }
    </style>
</head>
<body>

<div id="loadingOverlay">
    <div style="font-size: 1.5rem; color: var(--gold); margin-bottom: 20px;">Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¹Ø¨Ø± Hugging Face... ğŸš€</div>
    <div class="spinner"></div>
</div>

<div id="setupScreen" class="setup-container">
    <h1 style="color:var(--gold);">ØªØ­Ø¯ÙŠ Ø³ÙŠÙ† Ø¬ÙŠÙ… AI ğŸ†</h1>
    <p>Ø§Ø®ØªØ± 6 ÙØ¦Ø§Øª (Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ù…Ø§Ø°Ø¬ Ù…ÙØªÙˆØ­Ø© Ø§Ù„Ù…ØµØ¯Ø± Ù…Ø¬Ø§Ù†ÙŠØ©):</p>
    <div id="catGrid" class="cat-grid"></div>
    <button id="startBtn" class="btn-start" style="display:none" onclick="startGame()">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ø¯ÙŠ ğŸš€</button>
</div>

<div id="gameScreen" style="display:none">
    <div class="game-header">
        <div>ÙØ±ÙŠÙ‚ 1: <span id="s1">0</span></div>
        <div id="turnT" style="color:var(--gold)">Ø¯ÙˆØ±: ÙØ±ÙŠÙ‚ 1</div>
        <div>ÙØ±ÙŠÙ‚ 2: <span id="s2">0</span></div>
    </div>
    <div id="board" class="game-board"></div>
</div>

<div id="qModal" class="modal">
    <div id="timer" style="font-size: 3rem; color: yellow; font-weight: bold;">25</div>
    <div id="qText" style="font-size: 1.8rem; margin: 30px; line-height: 1.4;"></div>
    <div id="aText" style="display:none; color: var(--gold); border: 2px dashed; padding: 15px; border-radius: 10px; background: rgba(0,0,0,0.3); margin-bottom: 20px; width: 100%;"></div>
    <button id="revealBtn" class="btn-start" onclick="revealAnswer()">Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© ğŸ”“</button>
    <div id="scoreBtns" style="display:none; gap:10px; width: 100%;">
        <button onclick="addPoints(1)" style="flex:1; background:#28a745; color:white; border:none; padding:15px; border-radius:10px;">ÙØ±ÙŠÙ‚ 1 âœ…</button>
        <button onclick="addPoints(2)" style="flex:1; background:#28a745; color:white; border:none; padding:15px; border-radius:10px;">ÙØ±ÙŠÙ‚ 2 âœ…</button>
        <button onclick="closeModal()" style="flex:1; background:#dc3545; color:white; border:none; padding:15px; border-radius:10px;">Ø®Ø·Ø£ âŒ</button>
    </div>
</div>

<script>
    let HF_TOKEN = ""; // Ø³ÙŠØªÙ… Ø·Ù„Ø¨Ù‡ Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø¡
    // Ù†Ù…ÙˆØ°Ø¬ Ù‚ÙˆÙŠ ÙˆØ³Ø±ÙŠØ¹ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
    const MODEL_ID = "mistralai/Mistral-7B-Instruct-v0.2"; 

    const categories = ["Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…", "Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ù†Ø¨ÙˆÙŠØ©", "Ø±ÙŠØ§Ø¶Ø©", "Ø¹Ù„ÙˆÙ…", "ØªØ§Ø±ÙŠØ®", "Ø£Ù†Ù…ÙŠ", "ØªÙ‚Ù†ÙŠØ©", "ÙØ¶Ø§Ø¡", "Ø£Ù…Ø«Ø§Ù„", "Ø¬ØºØ±Ø§ÙÙŠØ§", "Ø³ÙŠØ§Ø±Ø§Øª", "Ø£ÙÙ„Ø§Ù…", "Ø¹Ø¬Ø§Ø¦Ø¨ Ø§Ù„Ø¯Ù†ÙŠØ§", "Ø£Ø¯Ø¨", "Ø§Ø®ØªØ±Ø§Ø¹Ø§Øª"];
    let selectedCats = []; let scores = [0, 0]; let turn = 1; let currentVal = 0; let clock;

    const grid = document.getElementById('catGrid');
    categories.forEach(cat => {
        const div = document.createElement('div');
        div.className = 'cat-item'; div.innerText = cat;
        div.onclick = () => {
            if(div.classList.contains('active')) {
                div.classList.remove('active');
                selectedCats = selectedCats.filter(c => c !== cat);
            } else if(selectedCats.length < 6) {
                div.classList.add('active');
                selectedCats.push(cat);
            }
            document.getElementById('startBtn').style.display = selectedCats.length === 6 ? 'block' : 'none';
        };
        grid.appendChild(div);
    });

    function startGame() {
        HF_TOKEN = prompt("Ø£Ø¯Ø®Ù„ Ù…ÙØªØ§Ø­ Hugging Face (Access Token): \n(ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„ÙŠÙ‡ Ù…Ø¬Ø§Ù†Ø§Ù‹ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø­Ø³Ø§Ø¨Ùƒ ÙÙŠ Hugging Face)");
        if (!HF_TOKEN) return;

        document.getElementById('setupScreen').style.display = 'none';
        document.getElementById('gameScreen').style.display = 'block';
        const board = document.getElementById('board');
        selectedCats.forEach(cat => {
            const sec = document.createElement('div');
            sec.className = 'cat-section';
            sec.innerHTML = `<div style="color:var(--gold); font-weight:bold; font-size:1.2rem; margin-bottom:10px;">${cat}</div><div class="vals-row">
                <div class="val-cell" onclick="handleCellClick('${cat}', 200, this)">200</div>
                <div class="val-cell" onclick="handleCellClick('${cat}', 400, this)">400</div>
                <div class="val-cell" onclick="handleCellClick('${cat}', 600, this)">600</div>
            </div>`;
            board.appendChild(sec);
        });
    }

    async function handleCellClick(cat, val, el) {
        el.classList.add('used');
        currentVal = val;
        document.getElementById('loadingOverlay').style.display = 'flex';
        
        try {
            const promptMsg = `<s>[INST] Ø£Ù†Øª Ø®Ø¨ÙŠØ± Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø«Ù‚Ø§ÙÙŠØ© Ø¹Ø±Ø¨ÙŠØ©. Ø£Ø¹Ø·Ù†ÙŠ Ø³Ø¤Ø§Ù„Ø§Ù‹ ÙˆØ§Ø­Ø¯Ø§Ù‹ ÙˆØ¬ÙˆØ§Ø¨Ù‡ ÙÙŠ ÙØ¦Ø© "${cat}" ÙˆØ¨Ù…Ø³ØªÙˆÙ‰ ØµØ¹ÙˆØ¨Ø© "${val}".
            ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¨ØµÙŠØºØ© JSON ÙÙ‚Ø· ÙƒØ§Ù„ØªØ§Ù„ÙŠ:
            {"q": "Ø§Ù„Ø³Ø¤Ø§Ù„ Ù‡Ù†Ø§ØŸ", "a": "Ø§Ù„Ø¬ÙˆØ§Ø¨ Ù‡Ù†Ø§"} [/INST]</s>`;

            const response = await fetch(`https://api-inference.huggingface.co/models/${MODEL_ID}`, {
                method: "POST",
                headers: {
                    "Authorization": `Bearer ${HF_TOKEN.trim()}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    inputs: promptMsg,
                    parameters: { max_new_tokens: 200, return_full_text: false }
                })
            });

            const result = await response.json();
            
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬ ÙˆØªØ­ÙˆÙŠÙ„Ù‡ Ù„Ù€ JSON
            let text = result[0].generated_text;
            let jsonStart = text.indexOf('{');
            let jsonEnd = text.lastIndexOf('}') + 1;
            let jsonString = text.substring(jsonStart, jsonEnd);
            
            const questionData = JSON.parse(jsonString);
            
            document.getElementById('loadingOverlay').style.display = 'none';
            showModal(questionData);

        } catch (err) {
            document.getElementById('loadingOverlay').style.display = 'none';
            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù€ Token Ø£Ùˆ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
            console.error(err);
        }
    }

    function showModal(data) {
        document.getElementById('qModal').style.display = 'flex';
        document.getElementById('qText').innerText = data.q;
        document.getElementById('aText').innerText = "Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©: " + data.a;
        document.getElementById('aText').style.display = 'none';
        document.getElementById('revealBtn').style.display = 'block';
        document.getElementById('scoreBtns').style.display = 'none';
        startTimer();
    }

    function startTimer() {
        let s = 25; document.getElementById('timer').innerText = s;
        clearInterval(clock);
        clock = setInterval(() => {
            s--; document.getElementById('timer').innerText = s;
            if(s <= 0) { clearInterval(clock); revealAnswer(); }
        }, 1000);
    }

    function revealAnswer() {
        clearInterval(clock);
        document.getElementById('aText').style.display = 'block';
        document.getElementById('revealBtn').style.display = 'none';
        document.getElementById('scoreBtns').style.display = 'flex';
    }

    function addPoints(f) {
        scores[f-1] += currentVal;
        document.getElementById('s1').innerText = scores[0];
        document.getElementById('s2').innerText = scores[1];
        turn = (turn === 1) ? 2 : 1;
        document.getElementById('turnT').innerText = "Ø¯ÙˆØ±: ÙØ±ÙŠÙ‚ " + turn;
        closeModal();
    }

    function closeModal() { document.getElementById('qModal').style.display = 'none'; }
</script>

<style>
    .spinner {
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top: 4px solid var(--gold);
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
</style>

</body>
</html>
